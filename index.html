
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="contributing/">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>pytmac</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pytmac" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="pytmac" class="md-header__button md-logo" aria-label="pytmac" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pytmac
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
            
              <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="pytmac" class="md-nav__button md-logo" aria-label="pytmac" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    pytmac
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="." class="md-nav__link md-nav__link--active">
        Home
      </a>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="pytmac/" class="md-nav__link">
        Pytmac
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Bin
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Bin
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="bin/get_config/" class="md-nav__link">
        Get config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="bin/init/" class="md-nav__link">
        Init
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="bin/input_validator/" class="md-nav__link">
        Input validator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="bin/resource_validator/" class="md-nav__link">
        Resource validator
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Scripts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Scripts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="scripts/generate_docs/" class="md-nav__link">
        Generate docs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><a href="https://app.fossa.com/projects/custom%2B37707%2Fgit%40github.com%3Atjtharrison%2Ftmac.git?ref=badge_shield"><img alt="FOSSA Status" src="https://app.fossa.com/api/projects/custom%2B37707%2Fgit%40github.com%3Atjtharrison%2Ftmac.git.svg?type=shield" /></a>
<img alt="Workflow Actionlint" src="https://github.com/tjtharrison/pytmac/actions/workflows/pr-actionlint.yaml/badge.svg" />
<img alt="Workflow Checkov" src="https://github.com/tjtharrison/pytmac/actions/workflows/pr-checkov.yaml/badge.svg" />
<img alt="Workflow Linting" src="https://github.com/tjtharrison/pytmac/actions/workflows/pr-linting.yaml/badge.svg" />
<img alt="Workflow Unit Tests" src="https://github.com/tjtharrison/pytmac/actions/workflows/pr-tests.yaml/badge.svg" />
<img alt="Workflow CodeQL" src="https://github.com/tjtharrison/pytmac/actions/workflows/pr-codeql.yaml/badge.svg" /></p>
<p><a href="https://badge.fury.io/py/pytmac"><img alt="PyPI version" src="https://badge.fury.io/py/pytmac.svg" /></a>
<a href="https://pypi.python.org/pypi/pytmac/"><img alt="PyPI download month" src="https://img.shields.io/pypi/dm/pytmac.svg" /></a>
<a href="https://pypi.python.org/pypi/pytmac/"><img alt="PyPI download week" src="https://img.shields.io/pypi/dw/pytmac.svg" /></a>
<a href="https://pypi.python.org/pypi/pytmac/"><img alt="PyPI download day" src="https://img.shields.io/pypi/dd/pytmac.svg" /></a></p>
<h1 id="pytmac">pytmac</h1>
<p>Python based threat modelling as code tool (Python T.M.A.C).</p>
<h1 id="installation">Installation</h1>
<p>pytmac is available via PyPi, and can be installed with pip:</p>
<pre><code>pip3 install pytmac
</code></pre>
<p>In order for DFD diagrams to be generated, <a href="https://plantuml.com/">plantuml</a> must be installed on the system. If it is not installed, pytmac will continue to execute but the output will not include a DFD diagram.</p>
<h1 id="usage">Usage</h1>
<p>Once installed, pytmac can be called from the command line with an array of arguments which are described in the help page:</p>
<pre><code>pytmac --help
</code></pre>
<h2 id="demonstration">Demonstration</h2>
<p>To generate an example report based on some pre-defined resources, run the following command:</p>
<pre><code>pytmac --demo
</code></pre>
<p>This will write to a file called <code>report-[today-date].md</code> which can be viewed in a markdown viewer.</p>
<h1 id="configuration">Configuration</h1>
<h2 id="init-mode">Init mode</h2>
<p>pytmac can be run in init mode to generate configuration files using a combination of inputs provided and default project settings. This can be done with the following command:</p>
<pre><code class="language-bash">pytmac --init
</code></pre>
<p>Once the initialisation has completed, you should review the generated files and make any changes required (Primary focus should be on the defaults file as this will globally define security settings for all generated resources in your project.</p>
<h2 id="config-file">Config file</h2>
<p>pytmac on launch will look for a file in the current directory named <code>.pytmac</code> as a source of settings. This file can be used to set the following settings:</p>
<pre><code>resource_file: &quot;docs/resources.yaml&quot;
config_file: &quot;docs/config.yaml&quot;
defaults_file: &quot;docs/defaults.yaml&quot;
</code></pre>
<p>If both a config file value and a manual override is added via the command line, the command line value will take precedence.</p>
<p>Eg if you have a .pytmac file with the following:</p>
<pre><code>resource_file: &quot;docs/resources.yaml&quot;
</code></pre>
<p>and call pytmac with the following:</p>
<pre><code>pytmac --resources-file resources.yaml
</code></pre>
<p>the resources.yaml file will be used over the one defined in the .pytmac file.</p>
<h2 id="resources">Resources</h2>
<p>Resources are defined as any asset that is part of the system being modelled under the following categories:</p>
<ul>
<li>Databases</li>
<li>Networks</li>
<li>Systems</li>
<li>Users</li>
</ul>
<p>Resources are provided to pytmac in a yaml file, which can be passed with the <code>--resources-file</code> argument. </p>
<p>An example of a <code>resources.yaml</code> can be found in the pytmac repository at <code>./docs/resources.yaml</code>.</p>
<p>Resource config defines characteristics of a given resource. Default settings for a given resource type can be set in 
the resource yaml as follows (following the same format for a resource type).</p>
<pre><code>resources:
  networks:
    - name: office_network
    - name: aws_public_subnet
      - config:
        is_cloud: true
</code></pre>
<h2 id="defaults">Defaults</h2>
<p>Defaults are defined as any setting that is common across all resources. These are provided to pytmac in a yaml file, which can be passed with the <code>--defaults-file</code> argument.</p>
<p>An example of a <code>defaults.yaml</code> can be found in the pytmac repository at <code>./docs/defaults.yaml</code>.</p>
<p>Defaults can be overridden by resource config, and are applied to all resources unless overridden.</p>
<h2 id="security-checks">Security Checks</h2>
<p>Security checks have been included to cover use cases for the Owasp top 10, however you may want to extend pytmac with custom checks can be written and added to <code>./docs/security_checks.yaml</code>. These files should be written as below, the 
checks are iterated over and executed individually, all fields are required.</p>
<p>Severity should be used as a combination of Risk vs Likelihood, any security findings are prioritised by severity in the report output. </p>
<pre><code>user_owned_device:
  name: Non company device used
  description: Checks for users with company_user true and company_device false.
  remediation: Understand and remediate or document known exception.
  severity: 3
  resource_scope:
    - users
  check_query:
    - resources[resource][&quot;company_user&quot;] and not resources[resource][&quot;company_device&quot;]
</code></pre>
<h2 id="outputs">Outputs</h2>
<p>The primary output of pytmac is a generated Markdown report, including a DFD (Data Flow Diagram) generated from the 
provided resources, and a programmatically generated list of security concerns using fields from the configuration
(including overrides).</p>
<p>Additionally, a yaml report is generated of all resources and their config - To ease reviewing the findings during a 
threat modelling session.</p>
<h1 id="release-details">Release Details</h1>
<p>This project uses <a href="https://semver.org/">semantic versioning</a> for releases, which are determined and managed by <a href="https://python-semantic-release.readthedocs.io/en/latest/">python-semantic-release</a>. </p>
<p>Python-semantic-release relies on conventional commits being used for all commit messages to determine the next version number / semantic release type (major/minor/patch).</p>
<p>Once the new version number has been determined, a new release is created on github, and the new version is published to PyPi.</p>
<h2 id="gpush">gpush</h2>
<p>You can use my other project <a href="https://github.com/tjtharrison/gpush">gpush</a> to ensure you always push commits with the correct format for this project, otherwise, details on commit message structure can be found on the <a href="https://www.conventionalcommits.org/en/v1.0.0/">conventional commits</a> website.</p>
<h2 id="documentation">Documentation</h2>
<p>Documentation is generated using <a href="https://www.mkdocs.org/">mkdocs</a>, and is hosted on github pages. To generate the documentation locally, run the following command:</p>
<blockquote>
<p>NOTE: Before running for the first time you will need to ensure that you have the required packages installed, you can do this as:</p>
</blockquote>
<pre><code class="language-agsl">pip3 install -r requirements.docs.txt
</code></pre>
<p>Now run the following make command to generate and serve the docs</p>
<pre><code class="language-bash">make mkdocs
</code></pre>
<p>This will generate a new copy of the documentation in the <code>./docs</code> directory and serve it on <code>http://localhost:8000</code>.</p>
<blockquote>
<p>NOTE: This action will also run during CI to ensure the documentation is up-to-date.</p>
</blockquote>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>